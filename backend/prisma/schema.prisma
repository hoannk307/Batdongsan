generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model favorites {
  id          Int        @id @default(autoincrement())
  user_id     Int
  property_id Int
  created_at  DateTime   @default(now())
  properties  properties @relation(fields: [property_id], references: [id], onDelete: Cascade)
  users       users      @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, property_id])
  @@index([user_id])
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model file_attach {
  id            Int        @id(map: "property_images_pkey") @default(autoincrement())
  object_id     Int
  path          String     @db.VarChar(500)
  nghiepvu_code String?    @db.Char(100)
  name          String?
  create_user   Int?
  create_date   DateTime?  @db.Date
  type          String?    @db.Char(20)
  extend        String?    @db.Char(20)
  properties    properties @relation(fields: [object_id], references: [id], onDelete: Cascade, map: "property_images_property_id_fkey")

  @@index([object_id], map: "property_images_property_id_idx")
}

model locations {
  id              Int          @id @default(autoincrement())
  code            String       @unique @db.VarChar(20)
  name            String       @db.VarChar(100)
  type            LocationType
  parent_id       Int?
  level           Int
  locations       locations?   @relation("locationsTolocations", fields: [parent_id], references: [id])
  other_locations locations[]  @relation("locationsTolocations")

  @@index([level])
  @@index([parent_id])
  @@index([type])
}

model news {
  id             Int        @id @default(autoincrement())
  user_id        Int
  title          String     @db.VarChar(255)
  slug           String     @unique @db.VarChar(255)
  summary        String?
  content        String
  featured_image String?    @db.VarChar(500)
  category       String?    @db.VarChar(50)
  views          Int        @default(0)
  status         NewsStatus @default(DRAFT)
  published_at   DateTime?
  created_at     DateTime   @default(now())
  updated_at     DateTime
  users          users      @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([category])
  @@index([slug])
  @@index([status, published_at])
}

model properties {
  id              Int            @id @default(autoincrement())
  property_type   String         @db.VarChar(100)
  property_status PropertyStatus
  beds            Int            @default(0)
  baths           Int            @default(0)
  area            Decimal        @db.Decimal(10, 2)
  price           Decimal        @db.Decimal(15, 2)
  description     String?
  any_city        String         @db.VarChar(100)
  any_ward        String         @db.VarChar(100)
  landmark        String?        @db.VarChar(255)
  created_at      DateTime       @default(now())
  user_id         Int?
  updated_at      DateTime?      @db.Date
  favorites       favorites[]
  file_attach     file_attach[]

  @@index([any_city])
  @@index([area])
  @@index([price])
  @@index([property_status, created_at], map: "properties_status_created_at_idx")
  @@index([property_type], map: "properties_type_idx")
}

model users {
  id         Int         @id @default(autoincrement())
  username   String      @unique @db.VarChar(50)
  email      String      @unique @db.VarChar(100)
  password   String      @db.VarChar(255)
  full_name  String?     @db.VarChar(100)
  phone      String?     @db.VarChar(20)
  role       UserRole    @default(USER)
  avatar     String?     @db.VarChar(255)
  created_at DateTime    @default(now())
  updated_at DateTime
  favorites  favorites[]
  news       news[]
}

enum LocationType {
  PROVINCE
  WARD
}

enum NewsStatus {
  PUBLISHED
  DRAFT
}

enum PropertyStatus {
  FOR_RENT
  FOR_SALE
}

enum UserRole {
  USER
  ADMIN
}
